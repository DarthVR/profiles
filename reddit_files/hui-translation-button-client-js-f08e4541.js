SML.di("./shell-e48e5956.js",import.meta.url,"shelle48e5956");SML.di("./index-970155ae.js",import.meta.url,"index970155ae");SML.di("./icon-c33661e6.js",import.meta.url,"iconc33661e6");SML.di("./expandable-section-header-41e0cfd1.js",import.meta.url,"expandablesectionheader41e0cfd1");SML.di("./faceplate-textarea-input-29f541e5.js",import.meta.url,"faceplatetextareainput29f541e5");SML.di("./translations-a30aa3ad.js",import.meta.url,"translationsa30aa3ad");SML.di("./translation-db230133.js",import.meta.url,"translationdb230133");SML.di("./app-selector-client-js-9964d0b0.js",import.meta.url,"appselectorclientjs9964d0b0");SML.di("./select-controller-4c63b3e8.js",import.meta.url,"selectcontroller4c63b3e8");SML.di("./table-pagination-77cf692d.js",import.meta.url,"tablepagination77cf692d");SML.di("./rpl-coachmark-4e17786a.js",import.meta.url,"rplcoachmark4e17786a");SML.di("./rpl-coachmark-card-5c5498b1.js",import.meta.url,"rplcoachmarkcard5c5498b1");SML.di("./helpers-4792ac4d.js",import.meta.url,"helpers4792ac4d");SML.di("./constants-9e09f052.js",import.meta.url,"constants9e09f052");SML.di("./community-picker-f331f77f.js",import.meta.url,"communitypickerf331f77f");SML.di("./age-gate-standalone-client-js-b13e879d.js",import.meta.url,"agegatestandaloneclientjsb13e879d");SML.di("./text-input-9c3f45be.js",import.meta.url,"textinput9c3f45be");SML.di("./links-22118b0c.js",import.meta.url,"links22118b0c");SML.di("./TinyGesture-26737d23.js",import.meta.url,"TinyGesture26737d23");SML.di("./user-flair-fe275854.js",import.meta.url,"userflairfe275854");SML.di("./tooltip.base-aa9651a3.js",import.meta.url,"tooltipbaseaa9651a3");SML.di("./utils-93db03dd.js",import.meta.url,"utils93db03dd");
SML.dm("huitranslationbuttonclientjsf08e4541",["shelle48e5956","index970155ae","iconc33661e6","expandablesectionheader41e0cfd1","faceplatetextareainput29f541e5","translationsa30aa3ad","translationdb230133","appselectorclientjs9964d0b0","selectcontroller4c63b3e8","tablepagination77cf692d","rplcoachmark4e17786a","rplcoachmarkcard5c5498b1","helpers4792ac4d","constants9e09f052","communitypickerf331f77f","agegatestandaloneclientjsb13e879d","textinput9c3f45be","links22118b0c","TinyGesture26737d23","userflairfe275854","tooltipbaseaa9651a3","utils93db03dd"],(async(t,e,a,i,n,s,o)=>{var l;!function(t){t.GREAT="great",t.NOT_GREAT="not great"}(l||(l={}));let r=class extends a.s{constructor(){super(...arguments),this.otherReasonFormValue="",this.isOpen=!1,this.handleDismiss=()=>{t.a(this,s.j()),this.close()}}show(){t.a(this,s.k()),this.faceplateDialog?.showModal?.(),this.isOpen=!0}close(){this.faceplateDialog?.close?.(),this.isOpen=!1,this.selectedOption=void 0,this.otherReasonFormValue=""}showThankYouAlert(){this.dispatchEvent(t.c("faceplate-alert",{level:t.x.success,message:"Thanks for rating"}))}handleUpvoteTranslation(){this.selectedOption=l.GREAT}handleDownvoteTranslation(){this.selectedOption=l.NOT_GREAT}handleSubmit(){this.selectedOption&&(t.a(this,s.l({reason:this.selectedOption,survey_text:this.otherReasonFormValue})),this.showThankYouAlert(),this.close())}render(){return a.x` <faceplate-dialog id="global-translation-feedback-faceplate-dialog" class="translation-feedback"> <div class="flex flex-col gap-lg"> <div class="flex justify-between"> <h3 class="font-bold text-24 text-neutral-content-strong m-0" data-testid="modal-title"> Enjoying these translations? </h3> ${t.r({attributes:{onclick:this.handleDismiss},appearance:"secondary",leadingIcon:a.C({size:a.I.Medium}),size:t.s.Medium})} </div> <p class="m-0" data-testid="modal-subtitle"> Tell us what you think about your translated Reddit experience. </p> <div class="flex justify-center gap-md"> <button data-testid="upvote-translation" class="py-md px-lg cursor-pointer border-none rounded-md ${this.selectedOption===l.GREAT?"bg-neutral-background-selected":"bg-neutral-background-medium"}" @click="${this.handleUpvoteTranslation}" @keydown="${this.handleUpvoteTranslation}"> <img src="${CLIENT_CONFIG.STATIC_BASE_URL}assets/snoomojis/Snoo_Expression_Smile_EyesOpen.png" class="block m-auto pb-xs" width="56" height="56" alt=""> <p class="font-semibold text-14 text-center text-neutral-content-strong m-0"> Great </p> </button> <button data-testid="downvote-translation" class="py-md px-lg cursor-pointer border-none rounded-md ${this.selectedOption===l.NOT_GREAT?"bg-neutral-background-selected":"bg-neutral-background-medium"}" @click="${this.handleDownvoteTranslation}" @keydown="${this.handleDownvoteTranslation}"> <img src="${CLIENT_CONFIG.STATIC_BASE_URL}assets/snoomojis/Snoo_Expression_Blanc.png" class="block m-auto pb-xs" width="56" height="56" alt=""> <p class="font-semibold text-14 text-center text-neutral-content-strong m-0"> Not Great </p> </button> </div> ${this.selectedOption?a.x` <div class="flex w-full box-border"> <faceplate-textarea-input data-testid="other-reason-input" maxlength="500" appearance="${n.a.BORDERED}" size="${n.T.EXPANDED}" @keyup="${t=>{t.stopPropagation(),this.otherReasonFormValue=t.target.value}}" class="w-full" .value="${this.otherReasonFormValue}"> <span slot="label">Leave a comment (optional)</span> </faceplate-textarea-input> </div> `:a.x``} <div class="flex justify-end"> ${t.r({appearance:"primary",size:t.s.Large,shape:"pill",attributes:{onclick:this.handleSubmit,className:"flex box-border","data-testid":"submit-feedback-button",disabled:!this.selectedOption},children:a.x`<span class="font-semibold text-14">Give Feedback</span>`})} </div> </div> </faceplate-dialog> `}};r.styles=[a.a`.translation-feedback{border-radius:16px;max-width:400px;padding:2rem 1.5rem 1.5rem 1.5rem;width:82%}`,t.t],t._([t.y("#global-translation-feedback-faceplate-dialog")],r.prototype,"faceplateDialog",void 0),t._([t.d()],r.prototype,"selectedOption",void 0),t._([t.d()],r.prototype,"otherReasonFormValue",void 0),t._([t.d()],r.prototype,"isOpen",void 0),r=t._([t.e("global-translation-feedback-modal")],r);const c="reddit-cookie-banner",h="faceplate-bottom-sheet#xpromo-bottom-sheet",d="faceplate-modal#blocking-modal",p=a.s;function u(t){return!!t?.open}let m=class extends p{constructor(){super(...arguments),this.activatableFeatures=[t.eL,t.eM,t.eN,t.eO],this.isDesktop=!1,this.withFeedback=!1,this.withActivatedFeatures=!1,this.translationContextValue=t.aw,this.withCoachmark=!1,this.withTranslationSettings=!1,this.hasCoachmarkDisplayLimit=!1,this.translationActiveMsg="Translations enabled",this.handleTranslationActiveSwitch=()=>{const t=!this.translationContextValue.isTranslationActive;this.dispatchContextUpdateEvent({isTranslationActive:t})},this.closeTranslationCoachmark=()=>{this.translationCoachmark?.hide?.(),this.onCoachmarkClose()},this.openTranslationCoachmark=()=>{t.a(this,o.e(!!this.translationContextValue.isTranslationActive)),this.translationCoachmark?.show?.()},this.openTranslationMenu=()=>{t.a(this,o.f(!!this.translationContextValue.isTranslationActive)),this.isDesktop?this.translationDropdownMenu?.show?.():this.translationMenuBottomSheet?.showModal?.()},this.closeTranslationMenu=()=>{t.a(this,o.f(!!this.translationContextValue.isTranslationActive)),this.isDesktop?this.translationDropdownMenu?.close?.():this.translationMenuBottomSheet?.close?.()},this.openFeedbackModal=()=>{this.translationFeedbackModal?.show?.()},this.handleCoachmarkSettingsClick=()=>{this.closeTranslationCoachmark(),this.openTranslationMenu(),t.a(this,o.g(o.h.UpdateSettings))},this.handleTranslationActiveClick=e=>{e.stopPropagation(),t.a(this,o.i(!!this.translationContextValue.isTranslationActive))},this.handleCoachmarkClick=t=>{t.stopPropagation()},this.handleCoachmarkCloseClick=()=>{this.closeTranslationCoachmark(),t.a(this,o.g(o.h.Dismiss))},this.handleNavMobileButtonClick=()=>{this.activateFeatures(),this.openTranslationMenu(),t.a(this,o.j(!!this.translationContextValue.isTranslationActive))},this.handleNavbarButtonClick=()=>{this.activateFeatures(),t.a(this,o.j(!!this.translationContextValue.isTranslationActive)),t.a(this,o.f(!!this.translationContextValue.isTranslationActive))},this.handleGiveFeedbackButtonClick=()=>{this.openFeedbackModal(),this.closeTranslationMenu()},this.onCoachmarkClose=()=>{setTimeout((()=>{this.dispatchContextUpdateEvent({shouldDisplayCoachmark:!1,shouldDisplayFeedbackCoachmark:!0})}),500)},this._activateFeature=t.k}connectedCallback(){super.connectedCallback();"mtseo-disabled"===t.l.getItem(t.L.I18nTranslationInterventionShown)&&(setTimeout((()=>{this.dispatchEvent(t.c("faceplate-alert",{level:t.x.success,message:"Translations are disabled."}))}),1e3),t.l.setItem(t.L.I18nTranslationInterventionShown,"true"))}updated(t){this.withCoachmark&&!this.hasCoachmarkDisplayLimit&&t.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&this.displayCoachmark()}displayCoachmark(){const{coachmarkDisplayCount:t,shouldDisplayCoachmark:e}=this.translationContextValue;window.setTimeout((()=>{if(!e)return;if(this.hasCoachmarkObstacles())return;const a=t<1;this.dispatchContextUpdateEvent({coachmarkDisplayCount:t+1,shouldDisplayCoachmark:a,shouldDisplayFeedbackCoachmark:!a}),a&&this.openTranslationCoachmark(),this.hasCoachmarkDisplayLimit=!0}),1500)}hasCoachmarkObstacles(){const e=!!document.querySelector(c),a=function(e){const a=document.querySelector(e);return a?t.dt(u,a):[]}(h),i=!!document.querySelector(d);return e||a?.length>0||i}dispatchContextUpdateEvent(t){const e={...this.translationContextValue,...t},a=new CustomEvent("update-translation-context",{bubbles:!0,composed:!0,detail:e});this.dispatchEvent(a)}featureShouldBeActivated(e){return!!document.querySelector(`faceplate-loader[name=${e}]`)&&!!document.querySelector(`faceplate-partial[name=${e}]`)&&!t.eP(e)}activateFeatures(){return this.withActivatedFeatures?Promise.all(this.activatableFeatures.filter(this.featureShouldBeActivated).map((t=>this._activateFeature({name:t})))):Promise.resolve()}renderCoachmark(){return this.translationContextValue.shouldDisplayCoachmark?a.x`<rpl-coachmark-card slot="content" appearance="inverted"> ${a.bG({size:a.I.Small,attributes:{slot:"title-icon"}})} <span slot="title" class="whitespace-nowrap">${this.translationActiveMsg}</span> <p class="max-w-[10rem] xs:max-w-none"> ${this.translationContextValue.isTranslationActive?"Posts and comments are automatically translated":"Automatically translate posts and comments"} </p> ${t.r({attributes:{"aria-label":"Close",id:"coachmark-close-button",onclick:this.handleCoachmarkCloseClick,slot:"close-button"},appearance:"plainInverted",leadingIcon:a.C({size:a.I.Small}),size:t.s.Small})} ${t.r({attributes:{slot:"primary-button",id:"coachmark-settings-button",onclick:this.handleCoachmarkSettingsClick},children:"Settings",appearance:"plainInverted",size:t.s.Small})} </rpl-coachmark-card>`:a.x``}renderDesktopMenu(){return a.x`<faceplate-dropdown-menu position="bottom-end" id="translation-desktop-menu"> ${t.r({size:t.s.Medium,appearance:"plain",shape:"pill",leadingIcon:a.bH({size:a.I.Medium}),attributes:{id:"translation-menu-button","aria-label":this.translationActiveMsg,onclick:this.handleNavbarButtonClick}})} <faceplate-menu slot="menu" dropdown hidden> ${i.l({label:a.x` <faceplate-switch-input id="hui-translation-switch" appearance="${e.S.PRIMARY}" class="inline-flex flex-row-reverse gap-sm" ?checked="${this.translationContextValue.isTranslationActive}" @input="${this.handleTranslationActiveSwitch}" @click="${this.handleTranslationActiveClick}"> <span class="-ml-xs">${this.translationActiveMsg}</span> </faceplate-switch-input> `,size:i.L.Medium})} ${this.withTranslationSettings?i.l({label:a.x` <span class="flex flex-row items-center"> ${a.bc({size:a.I.Medium})} <span class="ml-xs"> Translation Settings </span> </span> `,attributes:{id:"translation-settings-list-item"},size:i.L.Medium,href:"/settings/preferences"}):a.A} ${this.withFeedback?i.l({label:"Give translation feedback",attributes:{"data-testid":"hui-translation-button-feedback-option"},size:i.L.Medium,onClick:this.handleGiveFeedbackButtonClick}):a.A} </faceplate-menu> </faceplate-dropdown-menu>`}renderMobileMenu(){return a.x`<div> ${t.r({size:t.s.Medium,appearance:"plain",shape:"pill",leadingIcon:a.bH({size:a.I.Medium}),attributes:{id:"translation-menu-button",onclick:this.handleNavMobileButtonClick,"aria-label":this.translationActiveMsg}})} <faceplate-bottom-sheet id="translation-mobile-menu"> <div class="p-md flex flex-col items-stretch w-full gap-md"> <faceplate-switch-input id="hui-translation-switch" appearance="${e.S.PRIMARY}" class="flex flex-row-reverse justify-between gap-sm px-xs" ?checked="${this.translationContextValue.isTranslationActive}" @input="${this.handleTranslationActiveSwitch}" @click="${this.handleTranslationActiveClick}"> <span class="inline-flex items-center gap-xs"> ${a.bH({size:a.I.Medium})} <span> ${this.translationActiveMsg} </span> </span> </faceplate-switch-input> ${this.withFeedback?i.l({label:"Give translation feedback",attributes:{"data-testid":"hui-translation-button-feedback-option"},size:i.L.Medium,onClick:this.handleGiveFeedbackButtonClick}):a.A} </div> </faceplate-bottom-sheet> </div>`}render(){return a.x` <rpl-coachmark placement="${this.isDesktop?"bottom-end":"bottom"}" appearance="inverted" id="translation-coachmark" @click="${this.handleCoachmarkClick}" @rpl-coachmark:after-hide="${this.onCoachmarkClose}" style="--max-width:fit-content"> <div>${this.isDesktop?this.renderDesktopMenu():this.renderMobileMenu()}</div> ${this.renderCoachmark()} </rpl-coachmark> ${this.withFeedback?a.x` <global-translation-feedback-modal id="hui-translation-button-feedback-modal"></global-translation-feedback-modal>`:a.A} `}};m.styles=[t.t],t._([t.n({type:Boolean,attribute:"is-desktop"})],m.prototype,"isDesktop",void 0),t._([t.n({type:Boolean,attribute:"with-feedback"})],m.prototype,"withFeedback",void 0),t._([t.n({type:Boolean,attribute:"with-activated-features"})],m.prototype,"withActivatedFeatures",void 0),t._([t.av({context:t.ax,subscribe:!0}),t.d()],m.prototype,"translationContextValue",void 0),t._([t.n({type:Boolean,attribute:"with-coachmark"})],m.prototype,"withCoachmark",void 0),t._([t.n({type:Boolean,attribute:"with-translation-settings"})],m.prototype,"withTranslationSettings",void 0),t._([t.d()],m.prototype,"hasCoachmarkDisplayLimit",void 0),t._([t.y("#translation-coachmark")],m.prototype,"translationCoachmark",void 0),t._([t.y("#translation-desktop-menu")],m.prototype,"translationDropdownMenu",void 0),t._([t.y("#translation-mobile-menu")],m.prototype,"translationMenuBottomSheet",void 0),t._([t.y("#hui-translation-button-feedback-modal")],m.prototype,"translationFeedbackModal",void 0),m=t._([t.e("hui-translation-button")],m);let T=class extends a.s{constructor(){super(...arguments),this.translationContextValue=t.aw,this.isNewAccountAge=!1,this.isNewImmersiveVisit=!1,this.withBackendSetting=!1,this.newPreferredLanguages=[],this.requestClientGQL=t.B}connectedCallback(){super.connectedCallback(),this.isSettingInitialized()?this.syncTranslationSettingsWithCookie():this.initializeTranslationSettings(),this.newPreferredLanguages.length>0&&this.initializePreferredLanguageSettings()}initializePreferredLanguageSettings(){this.requestClientGQL({operation:t.O.UpdatePreferredLanguagesPreference,variables:{input:{languages:this.newPreferredLanguages}}})}updated(t){if(!t.has("translationContextValue")||!this.withBackendSetting)return;const e=t.get("translationContextValue"),a=this.translationContextValue.isTranslationActive,i=e?.isTranslationActive;if(void 0===i)return;(!0!==i&&!0===a||!1!==i&&!1===a)&&this.saveTranslationSettingInAccount(a)}async initializeTranslationSettings(){const e=this.fetchTranslationSettingFromCookie(),a=await this.fetchTranslationSettingFromGQL();let i,n={...this.translationContextValue};if(e&&(n={...n,...e}),null!==a&&a!==e?.isTranslationActive&&(n={...n,isTranslationActive:a},i=s.T.BACKEND),null===e&&null===a){const[t,e]=this.getFallbackIsTranslationActive();i=e,n={...n,isTranslationActive:t}}this.dispatchContextUpdateEvent(n),null===a&&void 0!==n.isTranslationActive&&this.saveTranslationSettingInAccount(n.isTranslationActive),i&&(n.isTranslationActive?t.a(this,s.m(i)):t.a(this,s.n(i))),sessionStorage.setItem(t.L.TranslationInitialized,Date.now().toString()),t.a(this,o.k(!!n.isTranslationActive))}getFallbackIsTranslationActive(){return this.isNewImmersiveVisit,this.isNewAccountAge?[!0,s.T.ACCOUNT_AGE]:[!1,s.T.DEFAULT_OFF]}syncTranslationSettingsWithCookie(){const e=this.fetchTranslationSettingFromCookie();let a={...this.translationContextValue};e&&e.isTranslationActive!==a.isTranslationActive&&(a={...a,...e},this.dispatchContextUpdateEvent(a)),t.a(this,o.k(!!a.isTranslationActive))}fetchTranslationSettingFromCookie(){const e=t.v.get(t.eQ)??"";return t.eR(e)}async fetchTranslationSettingFromGQL(){if(!this.withBackendSetting)return null;try{const{data:e}=await this.requestClientGQL({operation:t.O.IdentityImmersiveTranslationSetting}),a=e.identity?.preferences?.isMachineTranslationImmersive;return null==a||a===t.eS.Unset?null:a===t.eS.Enabled}catch{}return null}async saveTranslationSettingInAccount(e){if(!this.withBackendSetting)return null;try{await this.requestClientGQL({operation:t.O.UpdateAccountPreferences,variables:{input:{isMachineTranslationImmersive:e?t.eS.Enabled:t.eS.Disabled}}})}catch{}return null}dispatchContextUpdateEvent(t){const e=new CustomEvent("update-translation-context",{bubbles:!0,composed:!0,detail:t});this.dispatchEvent(e)}isSettingInitialized(){const e=sessionStorage.getItem(t.L.TranslationInitialized);return!!(e&&Date.now()-parseInt(e,10)<36e5)}render(){return a.x`<div> <slot></slot> </div>`}};t._([t.av({context:t.ax,subscribe:!0}),t.d()],T.prototype,"translationContextValue",void 0),t._([t.n({type:Boolean,attribute:"is-new-account-age"})],T.prototype,"isNewAccountAge",void 0),t._([t.n({type:Boolean,attribute:"is-new-immersive-visit"})],T.prototype,"isNewImmersiveVisit",void 0),t._([t.n({type:Boolean,attribute:"with-backend-setting"})],T.prototype,"withBackendSetting",void 0),t._([t.n({type:Array,attribute:"new-preferred-languages"})],T.prototype,"newPreferredLanguages",void 0),T=t._([t.e("translation-settings-admin")],T)}));