SML.di("./shell-e48e5956.js",import.meta.url,"shelle48e5956");SML.di("./utils-57a7018c.js",import.meta.url,"utils57a7018c");SML.di("./icon-c33661e6.js",import.meta.url,"iconc33661e6");SML.di("./faceplate-form-cff507f5.js",import.meta.url,"faceplateformcff507f5");SML.di("./community-onboarding-completed-modal-client-js-f4f5192c.js",import.meta.url,"communityonboardingcompletedmodalclientjsf4f5192c");SML.di("./text-input-9c3f45be.js",import.meta.url,"textinput9c3f45be");SML.di("./community-picker-f331f77f.js",import.meta.url,"communitypickerf331f77f");SML.di("./age-gate-standalone-client-js-b13e879d.js",import.meta.url,"agegatestandaloneclientjsb13e879d");SML.di("./constants-9e09f052.js",import.meta.url,"constants9e09f052");SML.di("./hui-user-drawer-client-js-91e856a7.js",import.meta.url,"huiuserdrawerclientjs91e856a7");SML.di("./TinyGesture-26737d23.js",import.meta.url,"TinyGesture26737d23");
SML.dm("agegateclientjscfcded38",["shelle48e5956","utils57a7018c","iconc33661e6","faceplateformcff507f5","communityonboardingcompletedmodalclientjsf4f5192c","textinput9c3f45be","communitypickerf331f77f","agegatestandaloneclientjsb13e879d","constants9e09f052","huiuserdrawerclientjs91e856a7","TinyGesture26737d23"],(async(t,e,i)=>{var s,n,r,o;!function(t){t.AgeCollect="age-collect",t.AgeRestrict="age-restrict",t.AgeVerify="age-verify",t.AgeConfirm="age-confirm"}(s||(s={})),function(t){t.UNAVAILABLE_AGE="UNAVAILABLE_AGE",t.UNAVAILABLE_UNVERIFIED_AGE="UNAVAILABLE_UNVERIFIED_AGE",t.UNDER_VERIFIED_AGE="UNDER_VERIFIED_AGE",t.UNVERIFIED_AGE="UNVERIFIED_AGE",t.UNDERAGE="UNDERAGE"}(n||(n={})),function(t){t.BeginVerification="begin-verification"}(r||(r={})),function(t){t.BeginVerification="/svc/shreddit/age-verification/begin-verification"}(o||(o={}));const a="force_age_gating";let c=window.location,l=class extends i.s{constructor(){super(...arguments),this.page=s.AgeCollect,this.postSubmitBehavior="destination",this.successDestination="reload",this.isSettingsCollection=!1,this.countdown=new e.C(this),this.pubsub=new t.P(this),this.onInputKeypress=t=>{"Enter"===t.key&&this.isValid?this.validateAge():isNaN(t.key)&&t.preventDefault()},this.onInput=()=>{this.clearErrorMessage(),this.saveButton.disabled=!this.isValid},this.redirectToAgeVerificationFlow=async()=>{if(this.withAgeVerification){this.submitButton.disabled=!0;try{const e=await fetch(o.BeginVerification,{body:JSON.stringify({completionUrl:this.getAgeVerificationCompletionUrl(),csrf_token:t.v.get("csrf_token")}),method:"POST"}),{data:i,error:s}=await e.json();if(!e.ok||!i?.continueUrl||s)throw new Error(`Failed to fetch age verification url from ${o.BeginVerification}`);c.href=i.continueUrl}catch(e){this.dispatchError("Something went wrong",t.aI(e)),this.submitButton.disabled=!1;const i=e;window.Sentry?.captureMessage?.(i.message)}}},this.submitAge=async()=>{try{const e=this.getDateString();if(null===e)return;const i=await fetch(t.bh.UpdateBirthdate,{method:"POST",body:JSON.stringify({birthdate:e,csrf_token:t.v.get("csrf_token")})});if(i.ok){if(this.withAgeVerification){const{collection_status:e}=await i.json();if(e===t.dc.Unverified)return void this.redirectToAgeVerificationFlow()}if("destination"===this.postSubmitBehavior)if("reload"===this.successDestination)this.reloadThePage();else{const t=new URL(this.successDestination);t.origin===c.origin&&(c.href=this.successDestination)}else"close"===this.postSubmitBehavior&&(this.pubsub.publish(t.T.AgeGateBirthdateSubmitted,{birthdate:e}),await(this.dialogSheet?.hide()),this.disableCollectionPage(),this.page=s.AgeCollect)}else this.dispatchError("Something went wrong",t.ag.FetchBadResponse)}catch(e){this.dispatchError("Something went wrong",t.aI(e))}},this.validateAge=()=>{const t=this.getDateString();null===t?(this.saveButton.disabled=!0,this.setErrorMessage("Invalid birthdate")):(this.agePlaceholder.date=e.g(t),this.page=s.AgeConfirm)},this.dispatchError=(e,i,s=t.x.error)=>{const n=t.c("faceplate-alert",{level:s,message:e});this.dispatchEvent(n)},this.updateCountdown=()=>{this.countdownText.textContent=this.countdown.secondsRemaining},this.cancelAndClose=()=>{this.page=s.AgeCollect,this.dialogSheet?.hide()},this.cancelAndRedirect=()=>{this.page=s.AgeRestrict,this.countdown.start(8e3),this.redirectTimeout=setTimeout(this.goHome,8e3)}}get dialogSheet(){return document.querySelector("#age-gate-interstitial")}get inputs(){return[this.querySelector('faceplate-text-input[name="year"]'),this.querySelector('faceplate-text-input[name="month"]'),this.querySelector('faceplate-text-input[name="day"]')].filter(Boolean)}get form(){return this.querySelector("faceplate-form")}get saveButton(){return this.querySelector("#age-gate-submit-btn")}get submitButton(){return this.querySelector(`[slot="${this.page}"] button[slot="primary-button"]`)}get isValid(){return Array.from(this.inputs).every((t=>t.value.length>0&&t.value.length<=(t.maxLength||4)))}get countdownText(){return this.querySelector("#age-restricted-countdown")}get agePlaceholder(){return this.querySelector("#age-date-placeholder")}connectedCallback(){super.connectedCallback(),this.addEventListener("input",this.onInput),this.addEventListener("change",this.onInput),this.inputs?.forEach((t=>t.addEventListener("keypress",this.onInputKeypress))),this.page===s.AgeRestrict&&this.cancelAndRedirect()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("input",this.onInput),this.removeEventListener("change",this.onInput),this.inputs?.forEach((t=>t.removeEventListener("keypress",this.onInputKeypress))),clearTimeout(this.redirectTimeout)}updated(t){super.updated(t),this.countdown.active&&this.updateCountdown()}getAgeVerificationCompletionUrl(){let e=c.origin;e.includes("old.reddit.com")&&(e=e.replace("old.reddit.com","www.reddit.com"));const i=new URL(`${e}/partner/persona/return`),s="reload"===this.successDestination?c.href:this.successDestination,n=new URL(s);n.searchParams.delete(a),i.searchParams.set("destination",n.toString());const r=t.X();return r&&i.searchParams.set("page-type",r),i.searchParams.set("variant","age-verification"),i.toString()}disableCollectionPage(){this.inputs.forEach((t=>{t.disabled=!0})),this.saveButton&&(this.saveButton.disabled=!0)}reloadThePage(){const t=new URL(c.href);t.searchParams.delete(a),t.href===c.href?c.reload():c.href=t.href}goHome(){c.href="/"}getDateString(){const[t,i,s]=Array.from(this.inputs).map((t=>parseInt(t?.value??"",10)));if(!s||!i||!t)return null;const n=new Date(t,i,0).getDate(),r=(new Date).getFullYear();return s<0||s>n||i<1||i>12||t<r-120||t>r-5?null:`${t}-${e.t(i)}-${e.t(s)}`}setErrorMessage(t){const e=this.form;this.inputs.forEach(((i,s)=>{e?.invalidateFieldWithMessage(i.name,0===s?t:" ")}))}clearErrorMessage(){const t=this.form;this.inputs.forEach((e=>{e.checkValidity()||t?.invalidateFieldWithMessage(e.name,"")}))}render(){return i.x`<slot name="${this.page}"></slot>`}};l.styles=[t.t],t._([t.n({type:Boolean,attribute:"with-age-verification"})],l.prototype,"withAgeVerification",void 0),t._([t.n({type:String,reflect:!0})],l.prototype,"page",void 0),t._([t.n({type:String,attribute:"post-submit-behavior"})],l.prototype,"postSubmitBehavior",void 0),t._([t.n({type:String,attribute:"post-success-destination"})],l.prototype,"successDestination",void 0),t._([t.n({type:Boolean,attribute:"is-settings-collection"})],l.prototype,"isSettingsCollection",void 0),l=t._([t.e("age-gate-dialog")],l)}));